<div class="form-floating" id="config-select"></div>

<div class="form-floating mt-3">
    <input type="number" class="form-control" id="nplayers" name="nplayers"
        placeholder="{% translate %}Number of players{% endtranslate %}" min="0" value="1">
    {# TODO: value = "{{ demo-size }}" #}
    <label for="nplayers" class="form-label">{% translate %}Number of players{% endtranslate %}</label>
</div>

<div x-data="{automatic: true}">
    <div class="form-check mt-3">
        <input class="form-check-input" type="checkbox" id="automatic_sname" name="automatic_sname" value="1"
            @click="automatic = !automatic" checked>
        <label for="automatic_sname">Set session name automatically</label>
    </div>
    <div class="form-floating mt-3" x-show="!automatic">
        <input class="form-control" type="text" id="sname" name="sname" placeholder="Session name">
        <label for="sname">Session name</label>
        <small class="d-block form-text pt-2 text-muted">
            {% translate %}
            The session name must be a valid Python identifier.
            For instance, it must not start with a digit, it must not contain spaces, and it must not cotain hyphens.
            {% endtranslate %}
        </small>
    </div>
</div>

<div x-data="{automatic: true}">
    <div class="form-check mt-3">
        <input class="form-check-input" type="checkbox" id="automatic_unames" name="automatic_unames" value="1"
            @click="automatic = !automatic" checked>
        <label for="automatic_unames">Set player names automatically</label>
    </div>
    <div class="form-floating mt-3" x-show="!automatic">
        <textarea class="form-control h-auto" id="unames" rows="10" name="unames" placeholder="Player names"></textarea>
        <label for="unames">Player names</label>
        <small class="d-block form-text pt-2 text-muted">
            {% translate %}
            Insert one player name per line of text. The number of player names must match the number of players.
            Each player name must be a valid Python identifier.
            For instance, it must not start with a digit, it must not contain spaces, and it must not cotain hyphens.
            {% endtranslate %}
        </small>
    </div>
</div>

<script>
    uproot.onStart(() => {
        renderConfigsApps(uproot.vars.configs, "config-select");
        const option = document.querySelector(`option[value='${defaultConfig}']`);
        if (option) { option.selected = true; }
    });

    function createSession() {
        let snameValid = true, unamesValid = true;

        if (!I("automatic_sname").checked) {
            snameValid = uproot.isPythonIdentifier(I("sname").value);
        }

        if (!I("automatic_unames").checked) {
            const unames = I("unames").value.split("\n").map((a) => a.trim());
            const wanted = parseInt(I("nplayers").value);
            unamesValid = unames.every(uproot.isPythonIdentifier);

            if (unames.length != wanted) {
                return uproot.error(_("You cannot create a session with #n1# players but #n2# player names.").replace("#n1#", wanted).replace("#n2#", unames.length));
            }
        }

        if (!snameValid) {
            uproot.error(_("The session name you entered is invalid."));
        }
        else if (!unamesValid) {
            uproot.error(_("The player names you entered are invalid."));
        }
        else {
            if (typeof preSubmit !== "undefined") {
                preSubmit();
            }

            document.forms[0].submit();
        }
    }
</script>