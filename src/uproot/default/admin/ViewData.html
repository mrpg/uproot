{% extends "Admin.html" %}

{% block title %}

{% translate %}
Session
{% endtranslate %}
<a href="../" class="font-monospace link-dark link-offset-2 link-underline-dark link-underline-opacity-25 link-underline-opacity-100-hover">{{ sname }}</a>
<span class="fw-light text-secondary">> {% translate %}
Data
{% endtranslate %}</span>

{% endblock title %}


{% block head %}

<style>
    /* Color of `id` column */
    #data.table-sticky tr > td:nth-of-type(1),
    #data.table-sticky tr > th:nth-of-type(1) {
        color: var(--bs-uproot);
    }
    /* Position to stick at for columns 2, 3 */
    #data.table-sticky tr > td:nth-of-type(2),  /* `label` */
    #data.table-sticky tr > th:nth-of-type(2) {
        left: 3em;
    }
    #data.table-sticky tr > td:nth-of-type(3),  /* `player` */
    #data.table-sticky tr > th:nth-of-type(3) {
        left: 6em;
    }
    #tableModalInner .table-sticky-inner {
        height: 100% !important;
        max-height: 94vh !important;
        resize: none !important;
    }
    #tableModalInner .table-sticky-outer {
        height: 95vh !important;
    }
</style>

{% endblock head %}


{% block main %}

<div class="d-flex flex-row justify-content-between mb-3">
    <div>
        <button type="button" class="btn btn-outline-uproot mb-2 me-2" onclick="refreshData()">{% translate %}Refresh{% endtranslate %}</button>
        <button type="button" class="btn btn-outline-uproot mb-2" data-bs-toggle="modal" data-bs-target="#tableModal">{% translate %}Full-screen table{% endtranslate %}</button>
    </div>
    <div>
        <a class="btn btn-uproot mb-2 me-2" href="../selectdata/">{% translate %}Download data{% endtranslate %}</a>
        <a class="btn btn-uproot mb-2" href="../monitor/">{% translate %}Monitor{% endtranslate %}</a>
    </div>
</div>

<div id="tableOuter">
    <div class="mt-3 table-sticky-outer">
        <div class="container p-0 table-sticky-inner">
            <table class="align-middle font-monospace mt-0 table table-hover table-responsive table-sticky text-nowrap" id="data">
                <thead>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="fade modal" id="tableModal" data-bs-backdrop="static" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-fullscreen">
        <div class="modal-content">
            <div class="modal-header py-2">
                <button type="button" class="btn btn-outline-uproot btn-sm" onclick="refreshData()">{% translate %}Refresh{% endtranslate %}</button>
                <button type="button" class="btn-close btn-sm" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body px-3 py-0" id="tableModalInner">
            </div>
        </div>
    </div>
</div>

{% endblock main %}


{% block late %}

<script src="{{ internal_static('tables.js') }}"></script>
<script src="{{ internal_static('viewdata.js') }}"></script>
<script>
    const dataTableEl = document.querySelector("#tableOuter .table-sticky-outer");
    const dataTableParent1 = I("tableOuter");
    const dataTableParent2 = I("tableModalInner");
    const tableModal = I("tableModal");

    uproot.onStart(
        () => refreshData(true)
    );

    tableModal.addEventListener("shown.bs.modal", () => {
        dataTableParent2.appendChild(dataTableEl);
    });

    tableModal.addEventListener("hidden.bs.modal", () => {
        dataTableParent1.appendChild(dataTableEl);
    });
</script>

{% endblock late %}
